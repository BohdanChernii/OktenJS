<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="user.css">
  <title>Document</title>
</head>
<body>
<section class="user">

  <div class="userInfo">
  </div>




  <button class="getComments">post of current user</button>
</section>
<script>

  let user_id = window.location.search.split('?').join('')

  fetch(`https://jsonplaceholder.typicode.com/users/${user_id}`).then(response => response.json())
    .then(res => {
    const userInfo = (user) => {

      for (const info  in user ) {
        if(typeof user[info] !== "object"){
          const p =  document.createElement('p')
          p.innerText = `${info} - ${user[info]}`
          document.querySelector('.userInfo').appendChild(p)
        }else{
          userInfo(user[info])
        }
      }
    }
      userInfo(res)

    })

  document.querySelector('.getComments').addEventListener('click', () => {
    fetch(`https://jsonplaceholder.typicode.com/users/${user_id}/posts`).then(response => response.json())
      .then(res => {
          const posts = document.createElement('div')
          posts.className = 'posts'

          res.map(item => {
            const post = document.createElement('div')
            post.className = 'post'

            const postBody= document.createElement('p')
            postBody.innerText = item.body

            const postTitle = document.createElement('h2')
            postTitle.innerText = item.title

            const link = document.createElement('a')
            link.setAttribute('href', `post-details.html?${item.id}`)
            link.innerText = 'go to post details'
            link.addEventListener("click", ()=>{
              console.log(item.id)
              console.log(item)
              localStorage.removeItem('post')
              localStorage.setItem('post',JSON.stringify(item))

            })
            post.append(postTitle, postBody, link)
            posts.appendChild(post)
          })
          document.querySelector('.user').appendChild(posts)
          document.querySelector('.getComments').disabled = true
          console.log(res);
        }
      );
  })
</script>
</body>
</html>